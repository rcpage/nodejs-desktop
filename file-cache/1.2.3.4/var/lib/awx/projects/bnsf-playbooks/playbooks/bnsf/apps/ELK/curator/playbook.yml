---
- hosts: all
  name: "BNSF Automation - Curator Playboook"
  vars:
    config: "{{ lookup('file','../../json/bnsfELK-node-params.json') }}"
  gather_facts: yes  
  tasks:

    - name: "Who Am I"
      shell: whoami
      register: whoami
      tags:
        - always

    - debug:
        var: hostvars
      tags:
        - always

    - name: "Create Curator Configuration Files"
      import_tasks: task.conf.create.yml
      vars:
        elk: "{{ config.default.bnsfELK }}"
        curator: "{{ config.default.bnsfCurator }}"
        elasticSearch: "{{ config.default.bnsfElasticSearch }}"
        templates: "../../templates"
        source_file: "{{ curator.configFilePreamble ~ curator.configFileSufix }}"
        ip_address: 'localhost'
        config_type: ""
        elastic_password: "12345"
      tags:
        - never
        - create.curator.config

    - name: "Delete Curator Configuration Files"
      import_tasks: task.conf.delete.yml
      vars:
        elk: "{{ config.default.bnsfELK }}"
        curator: "{{ config.default.bnsfCurator }}"
        files_to_remove:
          - "{{ curator.directory ~ '/' ~ curator.configFile }}"
          - "{{ curator.actionDirectory }}"
      tags:
        - never
        - delete.curator.config

    - name: "Install Curator Application"
      import_tasks: task.install.yml
      vars:
        curator: "{{ config.default.bnsfCurator }}"
        elk: "{{config.default.bnsfELK}}"
      tags:
        - never
        - install.curator

    - name: "Uinstall Curator Application"
      import_tasks: task.uninstall.yml
      vars:
        curator: "{{ config.default.bnsfCurator }}"
      tags:
        - never
        - uninstall.curator

    - name: "Nuke Curator Application"
      import_tasks: task.nuke.yml
      vars:
        curator: "{{ config.default.bnsfCurator }}"
      tags:
        - never
        - nuke.curator

    - name: "Dry Run Curator Configuration Files"
      import_tasks: task.service.run-dry.yml
      vars:
        elk: "{{ config.default.bnsfELK }}"
        curator: "{{ config.default.bnsfCurator }}"
      tags:
        - never
        - dry-run.curator.service

    - name: "Run Curator Configuration Files"
      import_tasks: task.service.run.yml
      vars:
        elk: "{{ config.default.bnsfELK }}"
        curator: "{{ config.default.bnsfCurator }}"
      tags:
        - never
        - run.curator.service




